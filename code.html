<!DOCTYPE html>
<html>

<head>
    <link rel="manifest" href="manifest.json">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <meta property="og:title" content="Web Harmonium" />
    <meta property="og:type" content="website" />
    <meta property="og:description"
        content="Play Harmonium using your normal computer keyboard or attach a MIDI keyboard to play" />
    <meta property="og:image" content="https://rajaramaniyer.github.io/webharmonium.png" />
    <meta property="og:image:width" content="1200" />
    <meta property="og:image:height" content="675" />
    <meta property="og:url" content="https://rajaramaniyer.github.io/webharmonium.html" />
    <link rel="shortcut icon" href="/images/icons/webharmonium_016.png" />
    <link rel="apple-touch-icon" href="images/icons/webharmonium_072.png" />
    <link rel="apple-touch-icon" href="images/icons/webharmonium_096.png" />
    <link rel="apple-touch-icon" href="images/icons/webharmonium_128.png" />
    <link rel="apple-touch-icon" href="images/icons/webharmonium_144.png" />
    <link rel="apple-touch-icon" href="images/icons/webharmonium_152.png" />
    <link rel="apple-touch-icon" href="images/icons/webharmonium_192.png" />
    <link rel="apple-touch-icon" href="images/icons/webharmonium_512.png" />

    <style>
        .white {
            fill: white;
            stroke: black;
            stroke-width: 1;
            cursor: pointer;
            margin: 2px;
        }

        .black {
            fill: black;
            stroke: black;
            stroke-width: 1;
            cursor: pointer;
            margin: 2px;
        }

        .white1:hover {
            fill: #9e9e9e;
            stroke: lightblue;
            cursor: pointer;
            stroke-width: 1;

        }

        .black1:hover {
            fill: #515151;
            stroke: lightblue;
            stroke-width: 1;

        }

        .slidecontainer {
            width: 100%;
            /* Width of the outside container */
        }

        /* The slider itself */
        .slider {
            -webkit-appearance: none;
            /* Override default CSS styles */
            appearance: none;
            width: 100%;
            /* Full-width */
            height: 25px;
            /* Specified height */
            background: #d3d3d3;
            /* Grey background */
            outline: none;
            /* Remove outline */
            opacity: 0.7;
            /* Set transparency (for mouse-over effects on hover) */
            -webkit-transition: .2s;
            /* 0.2 seconds transition on hover */
            transition: opacity .2s;
        }

        /* Mouse-over effects */
        .slider:hover {
            opacity: 1;
            /* Fully shown on mouse-over */
        }

        /* The slider handle (use -webkit- (Chrome, Opera, Safari, Edge) and -moz- (Firefox) to override default look) */
        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            /* Override default look */
            appearance: none;
            width: 25px;
            /* Set a specific slider handle width */
            height: 25px;
            /* Slider handle height */
            background: #4CAF50;
            /* Green background */
            cursor: pointer;
            /* Cursor on hover */
        }

        .slider::-moz-range-thumb {
            width: 25px;
            /* Set a specific slider handle width */
            height: 25px;
            /* Slider handle height */
            background: #4CAF50;
            /* Green background */
            cursor: pointer;
            /* Cursor on hover */
        }

        /* CSS for toggle button */
        .switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            -webkit-transition: .4s;
            transition: .4s;
        }

        .toggle:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            -webkit-transition: .4s;
            transition: .4s;
        }

        input:checked+.toggle {
            background-color: #2196F3;
        }

        input:focus+.toggle {
            box-shadow: 0 0 1px #2196F3;
        }

        input:checked+.toggle:before {
            -webkit-transform: translateX(26px);
            -ms-transform: translateX(26px);
            transform: translateX(26px);
        }

        /* Rounded sliders */
        .toggle.round {
            border-radius: 34px;
        }

        .toggle.round:before {
            border-radius: 50%;
        }
    </style>
    <title>Web Harmonium - developed by Rajaraman Iyer</title>
    <script>
        var sampleURL = 'harmonium-kannan-orig.wav';
        var debug = false;

        var AudioContext = AudioContext || webkitAudioContext,
            context = null;

        var audioBuffer = null;
        var gainNode = null;
        var reverbNode = null;
        var useReverb = false;
        var sourceNodes = new Array();
        var sourceNodeState = new Array();
        var keyboardMap = {
            "s": 53,   "S": 53,
            "a": 54,   "A": 54,
            "`": 55,   
            "1": 56,   
            "q": 57,   "Q": 57,
            "2": 58,   
            "w": 59,   "W": 59,
            "e": 60,   "E": 60,
            "4": 61,   
            "r": 62,   "R": 62,
            "5": 63,   
            "t": 64,   "T": 64,
            "y": 65,   "Y": 65,
            "7": 66,   
            "u": 67,   "U": 67,
            "8": 68,   
            "i": 69,   "I": 69,
            "9": 70,   
            "o": 71,   "O": 71,
            "p": 72,   "P": 72,
            "-": 73,   
            "[": 74,   
            "=": 75,   
            "]": 76,   
            "\\": 77,  
            "'": 78,   
            ";": 79
        }
        var swaramMap = {
            "s": "Ṃ",  "S": "Ṃ",
            "a": "Ṃ",  "A": "Ṃ",
            "`": "P̣",  
            "1": "Ḍ",  
            "q": "Ḍ",  "Q": "Ḍ",
            "2": "Ṇ",  
            "w": "Ṇ",  "W": "Ṇ",
            "e": "S",  "E": "S",
            "4": "R",  
            "r": "R",  "R": "R",
            "5": "G",  
            "t": "G",  "T": "G",
            "y": "M",  "Y": "M",
            "7": "M",  "7": "M",
            "u": "P",  "U": "P",
            "8": "D",  
            "i": "D",  "I": "D",
            "9": "N",  
            "o": "N",  "O": "N",
            "p": "Ṡ",  "P": "Ṡ",
            "-": "Ṙ",  
            "[": "Ṙ",  
            "=": "Ġ",  
            "]": "Ġ",  
            "\\": "Ṁ", 
            "'": "Ṁ",  
            ";": "Ṗ",  
            ",": ","  
        }
        var notation=""

        var loopStart = 0.5,
            loopEnd = 7.5,
            loop = true;

        var keyMap = new Array();
        var baseKeyMap = new Array();
        var middleC = 60;
        var rootKey = 62;
        var currentOctave = 3;
        var stackCount = 0;
        var octaveMap = [-36, -24, -12, 0, 12, 24, 36]
        var baseKeyNames = [
            "C", "C#", "D", "D#", "E", "F", "F#", "G", "G#", "A", "A#", "B"
        ];
        var keyNames = new Array();

        function getCharLength (str) {
            // The string iterator that is used here iterates over characters,
            //  not mere code units
            return [...str].length;
        }

        function init() {
            var transpose = parseInt(document.getElementById('transpose').innerText)

            var startKey = (middleC - 124) + (rootKey - middleC);
            for (i = 0; i < 128; ++i) {
                baseKeyMap[i] = startKey++;
                keyMap[i] = baseKeyMap[i] + transpose
            }
            if (debug) console.log(baseKeyMap)
            if (debug) console.log(keyMap)

            for (i = 0; i < keyMap.length; ++i) {
                if (debug) console.log("Building keySound", i, "keyMap", keyMap[i])
                sourceNodes[i] = null
                setSourceNode(i)
            }

            document.getElementById('mainScreen').style.display = 'block'
        }

        function setSourceNode(i) {
            if (sourceNodes[i] != null && sourceNodeState[i] == 1) {
                sourceNodes[i].stop(0);
            }
            sourceNodeState[i] = 0
            sourceNodes[i] = null
            sourceNodes[i] = context.createBufferSource();
            sourceNodes[i].connect(gainNode).connect(context.destination);
            sourceNodes[i].buffer = audioBuffer;
            sourceNodes[i].loop = loop;
            sourceNodes[i].loopStart = loopStart;
            //sourceNodes[i].loopEnd = loopEnd;
            if (keyMap[i] != 0)
                sourceNodes[i].detune.value = keyMap[i] * 100;
        }

        function noteOff(note) {
            var i = note + octaveMap[currentOctave]
            if (debug) console.log("noteOff", note, "currentOctave", currentOctave, "i", i)
            if (i < sourceNodes.length) {
                setSourceNode(i)
            }
            for (c = 1; c <= stackCount; ++c) {
                i = note + octaveMap[currentOctave + c]
                if (i < sourceNodes.length) {
                    setSourceNode(i)
                }
            }
        }

        function noteOn(note) {
            var i = note + octaveMap[currentOctave]
            if (debug) console.log("noteOn", note, "currentOctave", currentOctave, "i", i)
            if (i < sourceNodes.length && sourceNodeState[i] == 0) {
                sourceNodes[i].start(0);
                sourceNodeState[i] = 1
            }
            for (c = 1; c <= stackCount; ++c) {
                i = note + octaveMap[currentOctave + c]
                if (i < sourceNodes.length && sourceNodeState[i] == 0) {
                    sourceNodes[i].start(0);
                    sourceNodeState[i] = 1
                }
            }
        }

        window.onkeydown = function (event) {
            if (!event.repeat) {
                if (debug) console.log("keyDown", event.key, "keyboardMap", keyboardMap[event.key]);
                if (typeof (keyboardMap[event.key]) != "undefined") {
                    noteOn(keyboardMap[event.key]);
                }
            }
        }

        window.onkeyup = function (event) {
            const key = event.key
            if (debug) console.log("keyUp", key, "keyboardMap", keyboardMap[key]);
            if (typeof (keyboardMap[key]) != "undefined") {
                noteOff(keyboardMap[key]);
            }

            if (key === "Backspace" && getCharLength(notation) > 0) {
                notation=notation.substring(0, getCharLength(notation)-1)
            } else if (key === "Delete") {
                notation=""
            } else if (key === "Enter") {
                console.log(notation)
                notation=""
            } else if (key === "Tab") {
                notation += ","
            } else if (typeof (swaramMap[key]) != "undefined") {
                notation += swaramMap[key]
            }
        }

        function initReverbNode() {
            reverbNode = context.createConvolver();

            var request1 = new XMLHttpRequest();
            request1.open('GET', "reverb.wav", true);
            request1.responseType = 'arraybuffer';

            request1.addEventListener('load', function () {
                context.decodeAudioData(
                    request1.response,
                    function (buffer) {
                        if (debug) console.log("Got sample. Size", buffer.length)
                        reverbNode.buffer = buffer;
                        reverbNode.connect(context.destination);
                        updateReverbState(useReverb)
                    },
                    function (e) {
                        console.error('ERROR: context.decodeAudioData:', e);
                    }
                );
            });

            request1.send();
        }
        function load() {
            context = new AudioContext();

            gainNode = context.createGain();
            gainNode.gain.value = 0.3; // setting it to 30%
            gainNode.connect(context.destination);

            if (typeof (Storage) !== "undefined") {
                if (localStorage.getItem("webharmonium.volume") != null) {
                    document.getElementById("myRange").value = localStorage.getItem("webharmonium.volume");
                    onGainChange();
                }
                if (localStorage.getItem("webharmonium.useReverb") != null) {
                    useReverb = localStorage.getItem("webharmonium.useReverb") == "true";
                    document.getElementById("useReverb").checked = useReverb
                }
                if (localStorage.getItem("webharmonium.octave") != null) {
                    currentOctave = localStorage.getItem("webharmonium.octave")
                    try {
                        currentOctave = parseInt(currentOctave)
                    } catch (err) {
                        currentOctave = 0
                    }
                }
                document.getElementById('octave').innerText = currentOctave;
                if (localStorage.getItem("webharmonium.transpose") != null) {
                    document.getElementById('transpose').innerText = localStorage.getItem("webharmonium.transpose");
                    let currentSemitone = parseInt(document.getElementById('transpose').innerText);
                    document.getElementById('rootNote').innerText = baseKeyNames[(currentSemitone >= 0) ? currentSemitone % 12 : currentSemitone + 12];
                }
                if (localStorage.getItem("webharmonium.stack") != null) {
                    stackCount = localStorage.getItem("webharmonium.stack")
                    try {
                        stackCount = parseInt(stackCount)
                    } catch (err) {
                        stackCount = 0
                    }
                }
                document.getElementById('stack').innerText = stackCount;
            }

            initReverbNode()

            // Fetch the sample
            var request = new XMLHttpRequest();
            request.open('GET', sampleURL, true);
            request.responseType = 'arraybuffer';

            request.addEventListener('load', function () {
                context.decodeAudioData(
                    request.response,
                    function (buffer) {
                        if (debug) console.log("Got sample. Size", buffer.length)
                        audioBuffer = buffer;
                        init();
                    },
                    function (e) {
                        console.error('ERROR: context.decodeAudioData:', e);
                    }
                );
            });

            request.send();
            requestMIDIAccess();
        }
        //End of Fetch the sample

        function requestMIDIAccess() {
            try {
                var midiInfo = document.getElementById('midiInputDevicesInfo');
                // Start of MIDI
                if (navigator.requestMIDIAccess) {
                    if ( midiInfo.innerText.indexOf('Supported!') == -1 ) {
                        midiInfo.innerText += " Supported! "
                    }
                    if (debug) console.log('This browser supports WebMIDI!');
                    navigator.requestMIDIAccess().then(onMIDISuccess, onMIDIFailure);
                } else {
                    if ( midiInfo.innerText.indexOf('Supported!') == -1 ) {
                        midiInfo.innerText += " Not Supported! "
                    }
                    if (debug) console.log('WebMIDI is not supported in this browser.');
                }
            }
            catch(err) {
                midiInfo.innerText += " Failed! " + err
            }
        }

        var midiAccess = null;
        function onMIDISuccess(midiAccessReceived) {
            if (debug) console.log("onMIDISuccess", midiAccessReceived);
            midiAccess = midiAccessReceived;
            var midiInputDevices = document.getElementById("midiInputDevices");
            for (i = 0; i < midiInputDevices.length; ++i) {
                midiInputDevices.remove(i);
            }
            for (var input of midiAccess.inputs.values()) {
                if (debug) console.log("Input port [type:'" + input.type + "'] id:'" + input.id + "' manufacturer:'" + input.manufacturer + "' name:'" + input.name + "' version:'" + input.version + "'");
                var option = document.createElement("option");
                option.id = input.id;
                option.text = input.name + " by " + input.manufacturer;
                midiInputDevices.add(option);
                input.onmidimessage = getMIDIMessage;
            }
        }

        function onMIDIFailure(error) {
            document.getElementById('midiInputDevicesInfo').innerText += " Failed! " + error;
            if (debug) console.log('Could not access your MIDI devices.', error);
        }

        function getMIDIMessage(message) {
            if (debug) console.log(message)
            var command = message.data[0];
            var note = message.data[1];
            var velocity = (message.data.length > 2) ? message.data[2] : 0; // a velocity value might not be included with a noteOff command

            var midiInputDevices = document.getElementById("midiInputDevices");
            if (debug) console.log("midiDeviceId", message.target.id)
            if (debug) console.log("selectedMidi", midiInputDevices.options[midiInputDevices.selectedIndex].id)
            if (message.target.id == midiInputDevices.options[midiInputDevices.selectedIndex].id) {
                if (debug) console.log("command", command, "note", note, "velocity", velocity);
                switch (command) {
                    case 144: // noteOn
                        if (velocity > 0) {
                            noteOn(note, velocity);
                        } else {
                            noteOff(note);
                        }
                        break;
                    case 128: // noteOff
                        noteOff(note);
                        break;
                    case 176: // control
                        if ( note == 7 ) { // volume
                            document.getElementById("myRange").value = (100 * velocity)/127;
                            onGainChange();
                        }
                        break;
                    // we could easily expand this switch statement to cover other types of commands such as controllers or sysex
                }
            }
        }

        // End of MIDI

        function shiftOctave(octave) {
            if (debug) console.log('currencOctave', currentOctave, 'octave', octave)
            if (currentOctave + octave >= 0 && currentOctave + octave <= 6) {
                currentOctave += octave;
                if (debug) console.log('currencOctave changed as ', currentOctave)

                if (typeof (Storage) !== "undefined") {
                    localStorage.setItem("webharmonium.octave", currentOctave);
                }
            }
            document.getElementById('octave').innerText = currentOctave
        }

        function changeStack(stack) {
            stackCount += stack
            if (stackCount < 0) {
                stackCount = 0;
            } else if (currentOctave + stackCount > 6) {
                stackCount = 6 - currentOctave
            }
            document.getElementById('stack').innerText = stackCount

            if (typeof (Storage) !== "undefined") {
                localStorage.setItem("webharmonium.stack", stackCount);
            }
        }

        function shiftSemitone(semitone) {
            var currentSemitone = parseInt(document.getElementById('transpose').innerText);
            if (currentSemitone + semitone >= -11 && currentSemitone + semitone <= 11) {
                currentSemitone += semitone
                document.getElementById('transpose').innerText = currentSemitone
                document.getElementById('rootNote').innerText = baseKeyNames[(currentSemitone >= 0) ? currentSemitone % 12 : currentSemitone + 12];
            }
            if (typeof (Storage) !== "undefined") {
                localStorage.setItem("webharmonium.transpose", document.getElementById('transpose').innerText);
            }
            init()
        }

        var notePlaying = 0;
        function play(polygon) {
            notePlaying = keyboardMap[polygon.getAttribute('key')];
            noteOn(notePlaying)
        }

        function stop(polygon) {
            noteOff(notePlaying)
        }

        function onGainChange() {
            if (debug) console.log("Inside onGainChange");
            if (typeof (Storage) !== "undefined") {
                localStorage.setItem("webharmonium.volume", document.getElementById("myRange").value);
            }
            document.getElementById('volumeLevel').innerText = document.getElementById("myRange").value + "%";
            if (gainNode != null) {
                gainNode.gain.value = document.getElementById("myRange").value / 100;
            }
        }

        function updateReverbState(stateValue) {
            useReverb = stateValue
            if (typeof (Storage) !== "undefined") {
                localStorage.setItem("webharmonium.useReverb", (useReverb ? "true" : "false"));
            }
            if (useReverb) {
                gainNode.connect(reverbNode)
            } else {
                try {
                    gainNode.disconnect(reverbNode)
                } catch (err) {

                }
            }
        }

        if ("serviceWorker" in navigator) {
            window.addEventListener("load", function() {
                navigator.serviceWorker
                .register("/serviceworker.js")
                .then(res => console.log("service worker registered"))
                .catch(err => console.log("service worker not registered", err));
            });
        }
    </script>
</head>

<body>
    <div class="w3-container w3-teal">
        <h3>Web Harmonium</h3>
    </div>

    <div id="load" class="w3-container w3-panel">
        <button class="w3-button w3-block w3-blue-gray"
            onclick="document.getElementById('load').style.display='none'; load();">Load
            Module</button>
    </div>
    <div id="mainScreen" style="display: none;">
        <center>
            <svg width=294 height=110>
                <polygon points="0,0 14,0 14,50 21,50 21,100 0,100 0,0 " class="white" key="`" onmousedown="play(this)"
                    onmouseup="stop(this)" ontouchstart="play(this)" ontouchend="stop(this)"
                    ontouchmove="console.log('touchmove',this.getAttribute('key'))"
                    ontouchcancel="console.log('touchcancel',this.getAttribute('key'))" />
                <polygon points="14,0 28,0 28,50 14,50 14,0 " class="black" key="1" onmousedown="play(this)"
                    onmouseup="stop(this)" ontouchstart="play(this)" ontouchend="stop(this)"
                    ontouchmove="console.log('touchmove',this.getAttribute('key'))"
                    ontouchcancel="console.log('touchcancel',this.getAttribute('key'))" />
                <polygon points="21,50 28,50 28,0 35,0 35,50 42,50 42,100 21,100 21,50 " class="white" key="q"
                    onmousedown="play(this)" onmouseup="stop(this)" ontouchstart="play(this)" ontouchend="stop(this)"
                    ontouchmove="console.log('touchmove',this.getAttribute('key'))"
                    ontouchcancel="console.log('touchcancel',this.getAttribute('key'))" />
                <polygon points="35,0 49,0 49,50 35,50 35,0 " class="black" key="2" onmousedown="play(this)"
                    onmouseup="stop(this)" ontouchstart="play(this)" ontouchend="stop(this)"
                    ontouchmove="console.log('touchmove',this.getAttribute('key'))"
                    ontouchcancel="console.log('touchcancel',this.getAttribute('key'))" />
                <polygon points="42,50 49,50 49,0 63,0 63,100 42,100 42,50 " class="white" key="w"
                    onmousedown="play(this)" onmouseup="stop(this)" ontouchstart="play(this)" ontouchend="stop(this)"
                    ontouchmove="console.log('touchmove',this.getAttribute('key'))"
                    ontouchcancel="console.log('touchcancel',this.getAttribute('key'))" />
                <polygon points="63,0 77,0 77,50 84,50 84,100 63,100 63,0 " class="white" key="e"
                    onmousedown="play(this)" onmouseup="stop(this)" ontouchstart="play(this)" ontouchend="stop(this)"
                    ontouchmove="console.log('touchmove',this.getAttribute('key'))"
                    ontouchcancel="console.log('touchcancel',this.getAttribute('key'))" />
                <polygon points="77,0 91,0 91,50 77,50 77,0 " class="black" key="4" onmousedown="play(this)"
                    onmouseup="stop(this)" ontouchstart="play(this)" ontouchend="stop(this)"
                    ontouchmove="console.log('touchmove',this.getAttribute('key'))"
                    ontouchcancel="console.log('touchcancel',this.getAttribute('key'))" />
                <polygon points="84,50 91,50 91,0 98,0 98,50 105,50 105,100 84,100 84,50 " class="white" key="r"
                    onmousedown="play(this)" onmouseup="stop(this)" ontouchstart="play(this)" ontouchend="stop(this)"
                    ontouchmove="console.log('touchmove',this.getAttribute('key'))"
                    ontouchcancel="console.log('touchcancel',this.getAttribute('key'))" />
                <polygon points="98,0 112,0 112,50 98,50 98,0 " class="black" key="5" onmousedown="play(this)"
                    onmouseup="stop(this)" ontouchstart="play(this)" ontouchend="stop(this)"
                    ontouchmove="console.log('touchmove',this.getAttribute('key'))"
                    ontouchcancel="console.log('touchcancel',this.getAttribute('key'))" />
                <polygon points="105,50 112,50 112,0 126,0 126,100 105,100 105,50 " class="white" key="t"
                    onmousedown="play(this)" onmouseup="stop(this)" ontouchstart="play(this)" ontouchend="stop(this)"
                    ontouchmove="console.log('touchmove',this.getAttribute('key'))"
                    ontouchcancel="console.log('touchcancel',this.getAttribute('key'))" />
                <polygon points="126,0 140,0 140,50 147,50 147,100 126,100 126,0 " class="white" key="y"
                    onmousedown="play(this)" onmouseup="stop(this)" ontouchstart="play(this)" ontouchend="stop(this)"
                    ontouchmove="console.log('touchmove',this.getAttribute('key'))"
                    ontouchcancel="console.log('touchcancel',this.getAttribute('key'))" />
                <polygon points="140,0 154,0 154,50 140,50 140,0 " class="black" key="7" onmousedown="play(this)"
                    onmouseup="stop(this)" ontouchstart="play(this)" ontouchend="stop(this)"
                    ontouchmove="console.log('touchmove',this.getAttribute('key'))"
                    ontouchcancel="console.log('touchcancel',this.getAttribute('key'))" />
                <polygon points="147,50 154,50 154,0 161,0 161,50 168,50 168,100 147,100 147,50 " class="white" key="u"
                    onmousedown="play(this)" onmouseup="stop(this)" ontouchstart="play(this)" ontouchend="stop(this)"
                    ontouchmove="console.log('touchmove',this.getAttribute('key'))"
                    ontouchcancel="console.log('touchcancel',this.getAttribute('key'))" />
                <polygon points="161,0 175,0 175,50 161,50 161,0 " class="black" key="8" onmousedown="play(this)"
                    onmouseup="stop(this)" ontouchstart="play(this)" ontouchend="stop(this)"
                    ontouchmove="console.log('touchmove',this.getAttribute('key'))"
                    ontouchcancel="console.log('touchcancel',this.getAttribute('key'))" />
                <polygon points="168,50 175,50 175,0 182,0 182,50 189,50 189,100 168,100 168,50 " class="white" key="i"
                    onmousedown="play(this)" onmouseup="stop(this)" ontouchstart="play(this)" ontouchend="stop(this)"
                    ontouchmove="console.log('touchmove',this.getAttribute('key'))"
                    ontouchcancel="console.log('touchcancel',this.getAttribute('key'))" />
                <polygon points="182,0 196,0 196,50 182,50 182,0 " class="black" key="9" onmousedown="play(this)"
                    onmouseup="stop(this)" ontouchstart="play(this)" ontouchend="stop(this)"
                    ontouchmove="console.log('touchmove',this.getAttribute('key'))"
                    ontouchcancel="console.log('touchcancel',this.getAttribute('key'))" />
                <polygon points="189,50 196,50 196,0 210,0 210,100 189,100 189,50 " class="white" key="o"
                    onmousedown="play(this)" onmouseup="stop(this)" ontouchstart="play(this)" ontouchend="stop(this)"
                    ontouchmove="console.log('touchmove',this.getAttribute('key'))"
                    ontouchcancel="console.log('touchcancel',this.getAttribute('key'))" />
                <polygon points="210,0 224,0 224,50 231,50 231,100 210,100 210,0 " class="white" key="p"
                    onmousedown="play(this)" onmouseup="stop(this)" ontouchstart="play(this)" ontouchend="stop(this)"
                    ontouchmove="console.log('touchmove',this.getAttribute('key'))"
                    ontouchcancel="console.log('touchcancel',this.getAttribute('key'))" />
                <polygon points="224,0 238,0 238,50 224,50 224,0 " class="black" key="-" onmousedown="play(this)"
                    onmouseup="stop(this)" ontouchstart="play(this)" ontouchend="stop(this)"
                    ontouchmove="console.log('touchmove',this.getAttribute('key'))"
                    ontouchcancel="console.log('touchcancel',this.getAttribute('key'))" />
                <polygon points="231,50 238,50 238,0 245,0 245,50 252,50 252,100 231,100 231,50 " class="white" key="["
                    onmousedown="play(this)" onmouseup="stop(this)" ontouchstart="play(this)" ontouchend="stop(this)"
                    ontouchmove="console.log('touchmove',this.getAttribute('key'))"
                    ontouchcancel="console.log('touchcancel',this.getAttribute('key'))" />
                <polygon points="245,0 259,0 259,50 245,50 245,0 " class="black" key="=" onmousedown="play(this)"
                    onmouseup="stop(this)" ontouchstart="play(this)" ontouchend="stop(this)"
                    ontouchmove="console.log('touchmove',this.getAttribute('key'))"
                    ontouchcancel="console.log('touchcancel',this.getAttribute('key'))" />
                <polygon points="252,50 259,50 259,0 273,0 273,100 252,100 252,50 " class="white" key="]"
                    onmousedown="play(this)" onmouseup="stop(this)" ontouchstart="play(this)" ontouchend="stop(this)"
                    ontouchmove="console.log('touchmove',this.getAttribute('key'))"
                    ontouchcancel="console.log('touchcancel',this.getAttribute('key'))" />
                <polygon points="273,0 294,0 294,100 273,100 273,0 " class="white" key="\" onmousedown="play(this)"
                    onmouseup="stop(this)" ontouchstart="play(this)" ontouchend="stop(this)"
                    ontouchmove="console.log('touchmove',this.getAttribute('key'))"
                    ontouchcancel="console.log('touchcancel',this.getAttribute('key'))" />

                <!--white keys-->
                <text x="7" y="65" fill="black" font-family="courier new" font-size="14">`</text>
                <text x="28" y="65" fill="black" font-family="courier new" font-size="14">q</text>
                <text x="49" y="65" fill="black" font-family="courier new" font-size="14">w</text>
                <text x="70" y="65" fill="black" font-family="courier new" font-size="14">e</text>
                <text x="91" y="65" fill="black" font-family="courier new" font-size="14">r</text>
                <text x="112" y="65" fill="black" font-family="courier new" font-size="14">t</text>
                <text x="133" y="65" fill="black" font-family="courier new" font-size="14">y</text>
                <text x="154" y="65" fill="black" font-family="courier new" font-size="14">u</text>
                <text x="175" y="65" fill="black" font-family="courier new" font-size="14">i</text>
                <text x="196" y="65" fill="black" font-family="courier new" font-size="14">o</text>
                <text x="217" y="65" fill="black" font-family="courier new" font-size="14">p</text>
                <text x="238" y="65" fill="black" font-family="courier new" font-size="14">[</text>
                <text x="259" y="65" fill="black" font-family="courier new" font-size="14">]</text>
                <text x="280" y="65" fill="black" font-family="courier new" font-size="14">\</text>

                <!--black keys-->
                <text x="16" y="30" fill="white" font-family="courier new" font-size="14">1</text>
                <text x="37" y="30" fill="white" font-family="courier new" font-size="14">2</text>
                <text x="79" y="30" fill="white" font-family="courier new" font-size="14">4</text>
                <text x="100" y="30" fill="white" font-family="courier new" font-size="14">5</text>
                <text x="142" y="30" fill="white" font-family="courier new" font-size="14">7</text>
                <text x="163" y="30" fill="white" font-family="courier new" font-size="14">8</text>
                <text x="184" y="30" fill="white" font-family="courier new" font-size="14">9</text>
                <text x="226" y="30" fill="white" font-family="courier new" font-size="14">-</text>
                <text x="247" y="30" fill="white" font-family="courier new" font-size="14">=</text>

                <text x="70" y="90" fill="blue" font-family="courier new" font-weight=bold font-size="14">C</text>
                <text x="91" y="90" fill="blue" font-family="courier new" font-weight=bold font-size="14">D</text>
                <text x="112" y="90" fill="blue" font-family="courier new" font-weight=bold font-size="14">E</text>
                <text x="133" y="90" fill="blue" font-family="courier new" font-weight=bold font-size="14">F</text>
                <text x="154" y="90" fill="blue" font-family="courier new" font-weight=bold font-size="14">G</text>
                <text x="175" y="90" fill="blue" font-family="courier new" font-weight=bold font-size="14">A</text>
                <text x="196" y="90" fill="blue" font-family="courier new" font-weight=bold font-size="14">B</text>

            </svg>
        </center>

        <div class="w3-container">

            <div class="w3-container w3-card">
                <h3 class="w3-color w3-blue-gray w3-center">Volume: <span id="volumeLevel"></span></h3>
                <div class="slidecontainer">
                    <input type="range" min="1" max="100" value="30" class="slider" id="myRange"
                        onchange="onGainChange()">
                </div>
            </div>
            <hr>

            <div class="w3-container w3-card">
                <h3 class="w3-color w3-blue-gray w3-center">
                    <span class="w3-left-align">Reverb</span>
                    <span class="w3-right-align">
                        <label class="switch">
                            <input id="useReverb" type="checkbox" onclick="updateReverbState(this.checked)">
                            <span class="toggle round"></span>
                        </label>
                    </span>
                </h3>
            </div>
            <hr>

            <div class="w3-container w3-card">
                <h3 class="w3-color w3-blue-gray w3-center">
                    <table width="100%">
                        <tbody>
                            <tr>
                                <td width="10%">&nbsp;</td>
                                <td width="80%"><span id="midiInputDevicesInfo">MIDI Keyboard</span></td>
                                <td align=right width="10%"><button onclick="requestMIDIAccess()"><i
                                            class="fa fa-refresh" style="font-size:36px;"></i></button></td>
                            </tr>
                        </tbody>
                    </table>
                </h3>
                <div class="w3-center" width="100%">
                    <select id="midiInputDevices" width="100%"></select>
                </div>
            </div>
            <hr>

            <div class="w3-container w3-card">
                <h3 class="w3-color w3-blue-gray w3-center">Transpose - <span id='rootNote'>C</span></h3>

                <table width="100%">
                    <tbody>
                        <tr>
                            <td class="w3-center" width="10%">
                                <a class="w3-btn w3-grey w3-round" style="width:75px"
                                    onclick="javascript:shiftSemitone(-1)">-</a>
                            </td>
                            <td class="w3-center" width="80%">
                                <h4><span id='transpose'>0</span></h4>
                            </td>
                            <td class="w3-center" width="10%">
                                <a class="w3-btn w3-grey w3-round" style="width:75px"
                                    onclick="javascript:shiftSemitone(1)">+</a>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <hr>

            <div class="w3-container w3-card">
                <h3 class="w3-color w3-blue-gray w3-center">Current Octave</h3>

                <table width="100%">
                    <tbody>
                        <tr>
                            <td class="w3-center" width="10%">
                                <a class="w3-btn w3-grey w3-round" style="width:75px"
                                    onclick="javascript:shiftOctave(-1)">-</a>
                            </td>
                            <td class="w3-center" width="80%">
                                <h4 id='octave'>4</h4>
                            </td>
                            <td class="w3-center" width="10%">
                                <a class="w3-btn w3-grey w3-round" style="width:75px"
                                    onclick="javascript:shiftOctave(1)">+</a>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <hr>

            <div class="w3-container w3-card">
                <h3 class="w3-color w3-blue-gray w3-center">Additional Reeds</h3>

                <table width="100%">
                    <tbody>
                        <tr>
                            <td class="w3-center" width="10%">
                                <a class="w3-btn w3-grey w3-round" style="width:75px"
                                    onclick="javascript:changeStack(-1)">-</a>
                            </td>
                            <td class="w3-center" width="80%">
                                <h4 id='stack'>0</h4>
                            </td>
                            <td class="w3-center" width="10%">
                                <a class="w3-btn w3-grey w3-round" style="width:75px"
                                    onclick="javascript:changeStack(1)">+</a>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

        </div>
    </div>
</body>

</html>
